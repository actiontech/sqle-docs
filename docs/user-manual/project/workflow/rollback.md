---
title: 回滚工单
---

回滚工单提供了一套完整的数据变更保护方案。当 SQL 执行导致意外的数据修改时，系统能快速将数据恢复到正确状态。通过智能备份推荐、多样化备份策略和一键回滚能力，确保数据变更的可靠性和可恢复性。

## 使用场景
* 业务数据批量更新后发现逻辑错误
  * 示例：会员积分计算规则错误导致的批量积分更新问题
* 系统升级后需要回退数据变更
  * 示例：新功能上线后发现严重 bug 需要回退数据
* 运营操作失误需要数据恢复
  * 示例：促销商品价格设置错误需要快速修正

## 前置条件

回滚功能需要预先开启备份配置，支持两个层级：

* 数据源级别（推荐）
  * 适用：对所有使用该数据源的工单生效
  
* 工单级别
  * 适用：仅对当前工单生效
  * 优先级高于数据源级别配置


## 操作步骤
1. 配置备份策略

在创建工单时，确认或配置备份策略：

:::tip
**支持的备份类型**
1. 反向 SQL 备份
   * 自动生成反向 SQL 语句
   * 适用于简单的数据修改场景
2. 行级备份
   * 保存完整的行数据历史
   * 适用于复杂的数据修改场景
3. 手工备份
   * 用户自定义备份时机和内容
   * 适用于特殊业务场景
4. 无备份模式
   * 不进行数据备份
   * 适用于只读或测试场景

**智能推荐逻辑**

系统基于以下因素自动推荐最优备份策略：

* SQL 语句类型：分析 DML 语句的复杂度
* 影响数据量：评估变更影响的行数
* 操作复杂度：判断是否涉及多表、触发器等

:::


2. 执行工单

    * 确认备份配置
      * 检查备份策略是否符合预期
      * 验证备份范围是否完整

   * 执行变更
      * 按正常流程执行工单
      * 系统自动完成数据备份


3. 执行回滚

   * 发起回滚
      * 触发时机：发现数据异常
      * 入口：工单详情 > 回滚按钮
      * 时效性：建议在发现问题后尽快执行

   * 选择范围
      * 支持表级回滚：恢复整表数据
      * 支持行级回滚：选择特定数据行
      * 支持字段级回滚：仅恢复部分字段

   * 确认执行
      * 系统展示回滚预览
      * 创建回滚工单
      * 正常执行变更流程

   * 失败处理
      * 报错排查：查看错误日志
      * 重试机制：支持失败重试


## 注意事项
* 重要变更前，通过测试环境验证备份和回滚
* 执行回滚前，确认回滚范围的准确性
* 定期检查备份状态，确保备份链路正常
